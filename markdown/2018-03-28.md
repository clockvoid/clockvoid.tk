# CookPad Tech Kitchen #15に行ってきた話し

<p class="date">2018-03-28</p>

今日はCookPad Tech Kitchenに行ってきたので，それについてまとめてみようと思います．

それにしても恵比寿の街は思ったより住宅街的でしたが，クックパッドのある恵比寿ガーデンテラスはとてもりあじゅうが多くて怖かったです．

## 一人目:cookPadTVのLIVE配信の裏側
### cookPadTV
クッキングライブアプリ，3/8リリース

リアルタイムで双方向のコニュニケーションができる．

### LIVE配信
AWSのElemental MediaLive，MedisStoreをと買っているみたい．

Scutity Gropが設定されている．

Security GroupはInputの時点でしか作れかなった．
→その前にサーバ（haproxy）を挟んで，なんとか解決！

### コメント，ハート
APIサーバ

同時接続，流量が多い

アプリからのポストを他のアプリに投げる必要がある．

ECS ServiceのAuto Scaling

Goを使って高速化

データベースは使わない（遅くなるから）．そのため，寿命の短い認証はキャッシュを作り，データの永続化は非同期で行う．

Firebase Realtime Databasedで双方向通信を実現

最新のコメントだけをJSONに乗せて送ることで，データの転送量を減らしている．

## 二人目:Androidサイド
### LIVE配信画面
HLSを使っている．

Playlistに動画情報を記述→動画に関するメタ情報を医術できる，

GoogleのExoPlayerを使うだけで再生できる．

チューニングが必要．

アプリ側でフェッチできなくて，プレイリストだけ進んじゃうことがある．→エラー

LiveWindowを大きくすればいいが，タイムラグが生まれてしむ可能性がある．

手元のプレイリストを最新にしているだけの処理をしている．

### アーカイブ機能
コメントと動画の同期が必要

コメント一覧はサーバに保存している

HLSの字幕を使えばいいのでは？

WebVTTでフォーマットされた字幕をExoPlayerはレンダリングできる

## 三人目:storeTVの広告配信の今までとこれから
### 機能について
紙のポップに動画を追加できる！

cookPadの箱（？）というシステムを使えばサーバの構築はymlを書くだけらしい．

外部のMDMサービスを使っているらしい

常に動画を再生していたい．→アプリを更新したらアプリはkillされちゃうよね・・・

アプリからsleep/wakeupしたい
→アプリではsleepせず，OSの機能でやるようにした

### 広告について
impベース配信

サイネージの場合，画面が一つしかない→impベース配信

実は，4Gで通信している．→いろいろ問題が存在する．

## 四人目:cookpad studioについて
代官山で1店舗存在

機材なども全部揃う

レシピ投稿者なら無料

### アプリについて
iPadからCameraのSDKを叩いて撮影

カメラがアクセスポイントになって，そのカメラに対して接続して動画撮影，編集して，その後，アップロード

ただ，Olympus Airが生産終了

更に，電子レンジのノイズが結構ひどいらしい，

最終的に，iPhone Xのカメラでやることになったみたい．

iPadでQRコードを取るだけで簡単にiPhone XとP2P接続して，簡単に動画を取り込むことができてた！マジですごい．

## LT1:動画事業でのデータの扱い
ログを活用しながら前を向いて進んでいく

一ヶ月に1000代以上のペースで配布されている．
→しかし，本当に使われているのかわからない

そこで，ログを活用する．

普通のログ解析は面倒くさい．

tableauを使う．

## LT2:storeTVの開発事例
動画の数が多すぎて動画を選ぶのが大変だった

→動画をグルーピング

課題は食材名の表記ゆれ

全部同じものであるということを辞書で

GDBMとしてローカルキャッシュをしている

入稿が面倒くさかった
→入稿用のアプリを作成する

SNS+SQS

ECSをどう管理していくか

## LT3:モバイル開発について
cookpadTVアプリについて

アーキテクチャをVIPERベースにしてiOSとAndroidで統一したい．
UI/UXの差異も吸収したい

## VIPERの良さ
社内で経験ができたということらしい
