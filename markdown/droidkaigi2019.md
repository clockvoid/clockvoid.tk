# DroidKaigi 2019

Droid Kaigi 2019が開催されました！今日はDroid Kaigiで私が聞いたセッションのメモを残します．

## マルチモジュールでテストはどう変わる？
これまでのアプリでは，app内に複数のパッケージを作っていたが，これからはたくさんモジュール作る

build.gradleに書けば，他のモジュールも使える．
キャッシュにより，ビルド時間が短縮されたりAABに対応できたりする

テストの書き方自体は今までと変わらない．
変えなければ行けないのは，
* DI
* 方針
* メトリクスの収集

### DI
悩みポイント
* モジュール間の依存を完結にしたい
    * あるモジュールが必要な要素がそのモジュールそのものの要素に依存している場合
* 依存の定義技をモジュール内に保ちたい
    * DaggerでいうとModuleクラスの定義を使用

### テスト方針
モジュール化のメリットを受けるために，動作確認もモジュール内で管轄できるようにしたほうが良い

モジュール内で動作確認ができれば，全体のAPKをビルドしなくて良かったりするのでよい

→モジュール内でどのような動作確認ができればよいのか？

モノリシックなプロジェクトでは，レイヤーごとにユニットテストしていたが，レイヤに含まれないような部分はテストがなかったり，動作確認が足りなかったりした．
UIテストとか．

モジュールに分けると，モジュールごとにテストのやり方を考えることになるので，テストの漏れモスなくなる？

#### モジュール内のテスト
モジュールの責務とテスト範囲をまずは考える

ユニットテスト，結合テスト，UIテストを考える．

Utilityがたくさん入ったモジュールなら，それぞれユニットテストすればOK

Logic→Logic→Androidプラットフォームの場合，一番上のLogicにユニットテストをその下の2つに結合テストを．また，全部まとめて結合テストをしたりできる

Activity→Logic→プラットフォームの場合，ActivityをUIテストし，その下を結合テストしたり，全部UIテストしたりできる多分，下のLogicとかをモックしないとマズイ場合，前者を使えば良さげ

はじめはユニットテストから導入するとととても良い

結合テストやUIテストは，ユニットテストでは動作確認として不足している部分に追加！
Androidプラットフォームが絡むテストも簡単に導入できるようになってきたので，ガシガシ書くべき→Project Nitrogen:Robokectricでやるか，Virtual Boxでやるか選べる．
今年のQ1からアルファ版がさわれるか？

現状では，Robolectricで実行するにはtextに，Deviceで実験するにはandroidTestにテストを書く

もしテストを書く時間がなくてもテスタビリティは絶対に意識して実装するべき→テストをやるときにリファクタリングからする必要があるため

#### モジュールをまたいだテスト
モジュールごとにテストを完結されるか，まとめてやるか？

モジュールごとのテストは依存しているモジュールをモックすれば良い

モジュールをまたぐと言っても，今までと変わらないw
他のモジュールの依存が渡せてれば難しくない

### テストメトリクス収集
テストメトリクスはテストの実行結果Jacocoのレポートなど

各モジュールのレポートをまとめてみたい場合には，結果のマージが必要になる

普通はJacocoを使うが，PITとかいうやつが存在する

ミューテーションテスト:プロダクトコードを機械的に変換し，テストコードがちゃんと振る舞いをチェックできているかをチェックするツール！！！

PITは，変更して見て，成功したらNGとする．→協会チェックなどの漏れをチェックしてくれるのだ！

なんとAndroid用のGradle Pluginがある！→ただし，マージには対応せず

頑張って対応してるw．

サンプルも登壇者さんが作成
